# 唤醒词循环模式说明

## 概述

演示模式2已成功改为**唤醒词循环模式**：每次唤醒后只识别一次命令，然后自动回到休眠状态，需要重新说唤醒词才能继续使用。

---

## 修改内容

### 1. 功能变化

**修改前（持续监听模式）：**
- 说唤醒词"小助手"唤醒
- 唤醒后可以**持续**说多个命令
- 说"退出"或"再见"才结束
- 一直保持唤醒状态

**修改后（唤醒词循环模式）：**
- 说唤醒词"小助手"唤醒
- 唤醒后**只识别一次**命令
- 识别完成后**自动休眠**
- 需要**重新唤醒**才能继续

### 2. 代码实现

#### 核心逻辑
```python
def demo_continuous():
    """唤醒词循环演示 - 每次唤醒后只识别一次"""
    
    while True:
        # 1. 等待唤醒词
        print("😴 等待唤醒词: '小助手'...")
        if assistant.wait_for_wake_word():
            print("✅ 已唤醒! 请说出您的命令...")
            
            # 2. 识别一次命令
            result = assistant.listen_and_recognize()
            
            if result:
                # 3. 处理命令
                # ... 命令处理逻辑 ...
                
                # 4. 重置为未唤醒状态 ← 关键！
                assistant.is_awake = False
                print("💤 已进入休眠状态，需要重新唤醒")
            else:
                # 识别失败也重置状态
                assistant.is_awake = False
```

#### 关键改动
- ✅ 使用 `while True` 循环持续运行
- ✅ 每次循环都调用 `wait_for_wake_word()` 等待唤醒
- ✅ 识别完一次后设置 `assistant.is_awake = False`
- ✅ 自动进入下一次循环，重新等待唤醒

---

## 使用示例

### 示例1：基本使用流程

```bash
$ python voice_assistant.py
╔═══════════════════════════════════════╗
║     Python 语音助手演示程序          ║
╚═══════════════════════════════════════╝

请选择演示模式:
1. 基础演示 - 单次语音识别
2. 唤醒词循环 - 每次唤醒后识别一次命令

请输入选择 (1/2): 2

==================================================
唤醒词循环演示
==================================================

是否启用翻译功能？
1. 是（在线翻译）
2. 否
请选择 (1/2, 默认2): 1

🌐 已启用在线翻译模式

💡 提示: 每次唤醒后只识别一次，然后需要重新唤醒
💡 按 Ctrl+C 退出程序

😴 等待唤醒词: '小助手'...
```

### 示例2：完整交互流程

```bash
# 第一次交互
😴 等待唤醒词: '小助手'...
[用户说: "小助手"]
👂 听到: 小助手
✅ 已唤醒! 请说出您的命令...

🎤 请说话...
[用户说: "你好"]
✅ 识别结果: 你好
🌐 正在翻译成英文...
✅ 翻译结果: hello

📢 识别命令: 你好
   英文翻译: hello
🤖 回复: 你好!

💤 已进入休眠状态，需要重新唤醒

# 第二次交互（需要重新唤醒）
😴 等待唤醒词: '小助手'...
[用户说: "小助手"]
👂 听到: 小助手
✅ 已唤醒! 请说出您的命令...

🎤 请说话...
[用户说: "时间"]
✅ 识别结果: 时间

📢 识别命令: 时间
🤖 回复: 现在是 14:30

💤 已进入休眠状态，需要重新唤醒

# 第三次交互（退出）
😴 等待唤醒词: '小助手'...
[用户说: "小助手"]
✅ 已唤醒! 请说出您的命令...

🎤 请说话...
[用户说: "再见"]
✅ 识别结果: 再见

📢 识别命令: 再见
👋 收到退出命令，程序结束
```

### 示例3：不使用翻译

```bash
请输入选择 (1/2): 2

是否启用翻译功能？
1. 是（在线翻译）
2. 否
请选择 (1/2, 默认2): 2

💡 提示: 每次唤醒后只识别一次，然后需要重新唤醒
💡 按 Ctrl+C 退出程序

😴 等待唤醒词: '小助手'...
[说"小助手"]
✅ 已唤醒! 请说出您的命令...

[说"天气"]
📢 识别命令: 天气
🤖 回复: 今天天气不错哦!

💤 已进入休眠状态，需要重新唤醒

😴 等待唤醒词: '小助手'...
```

---

## 功能对比

### 与修改前的对比

| 特性 | 修改前（持续监听） | 修改后（唤醒词循环） |
|------|-------------------|---------------------|
| 唤醒方式 | 说唤醒词"小助手" | 说唤醒词"小助手" |
| 唤醒后行为 | 持续监听多个命令 | 只识别一次命令 |
| 休眠触发 | 说"退出"或"再见" | 每次识别后自动休眠 |
| 再次使用 | 无需重新唤醒 | **需要重新唤醒** ⭐ |
| 交互模式 | 连续对话 | 一问一答 |
| 适用场景 | 多轮对话、连续操作 | 单次查询、间歇使用 |

### 与其他语音助手的对比

| 语音助手 | 交互模式 | 本项目模式 |
|---------|---------|-----------|
| Siri | 唤醒词循环（一问一答） | ✅ 模式2 |
| Google Assistant | 唤醒词循环（一问一答） | ✅ 模式2 |
| Alexa | 持续监听（可配置） | 可通过代码实现 |
| 小爱同学 | 唤醒词循环（一问一答） | ✅ 模式2 |

**现在模式2的行为与主流语音助手一致！**

---

## 支持的命令

### 内置命令

1. **"你好"** → 回复："你好!"
2. **"时间"** → 显示当前时间
3. **"天气"** → 回复天气信息
4. **"退出"** 或 **"再见"** → 结束程序
5. **其他命令** → 回复："我听到了您的命令"

### 命令扩展

可以在代码中添加更多命令：

```python
# 在 demo_continuous() 函数中添加
if "音乐" in text:
    print("🤖 回复: 正在为您播放音乐")
elif "新闻" in text:
    print("🤖 回复: 这是今天的新闻...")
elif "提醒" in text:
    print("🤖 回复: 好的，我会提醒您")
```

---

## 工作流程

### 完整流程图

```
开始
  ↓
进入循环
  ↓
😴 等待唤醒词 "小助手"
  ↓
听到唤醒词？
  ├─ 否 → 继续等待
  └─ 是 ↓
    ✅ 已唤醒
      ↓
    🎤 识别一次命令
      ↓
    识别成功？
      ├─ 否 → 💤 休眠 → 回到循环开始
      └─ 是 ↓
        📢 处理命令
          ↓
        是退出命令？
          ├─ 是 → 👋 结束程序
          └─ 否 ↓
            🤖 执行命令
              ↓
            💤 休眠（is_awake = False）
              ↓
            回到循环开始
```

### 状态转换

```
[休眠状态] 
    ↓ 听到唤醒词
[唤醒状态]
    ↓ 识别命令
[处理中]
    ↓ 处理完成
[休眠状态] ← 自动循环
```

---

## 技术细节

### 关键代码解析

#### 1. 唤醒词等待
```python
print("😴 等待唤醒词: '小助手'...")
if assistant.wait_for_wake_word():
    print("✅ 已唤醒! 请说出您的命令...")
```
- 调用 `wait_for_wake_word()` 阻塞等待
- 检测到唤醒词后返回 `True`
- 自动设置 `assistant.is_awake = True`

#### 2. 命令识别
```python
result = assistant.listen_and_recognize(timeout=5, phrase_time_limit=10)
```
- 超时时间：5秒（等待开始说话）
- 录音时长：10秒（单次录音最长）
- 返回识别结果（可能包含翻译）

#### 3. 状态重置
```python
assistant.is_awake = False
print("💤 已进入休眠状态，需要重新唤醒")
```
- 关键步骤：设置 `is_awake = False`
- 确保下次循环时重新等待唤醒词
- 防止跳过唤醒直接识别

#### 4. 退出处理
```python
if "退出" in text or "再见" in text:
    print("👋 收到退出命令，程序结束")
    break  # 跳出循环
```
- 检测退出关键词
- `break` 跳出 `while True` 循环
- 程序正常结束

---

## 优势与适用场景

### 优势

1. **更符合语音助手习惯**
   - 类似 Siri、小爱同学等主流产品
   - 用户学习成本低

2. **更好的隐私保护**
   - 只在唤醒后短暂监听
   - 减少误触发和误识别
   - 降低持续录音的隐私风险

3. **更低的资源消耗**
   - 识别完成后立即休眠
   - 不需要持续监听
   - 节省计算资源

4. **更清晰的交互边界**
   - 明确的唤醒-响应-休眠流程
   - 用户知道何时可以说话
   - 减少混淆和误解

### 适用场景

✅ **间歇性使用**
- 偶尔查询天气、时间
- 不频繁的语音控制
- 单次信息获取

✅ **隐私敏感环境**
- 家庭环境
- 办公室
- 需要明确控制录音时机

✅ **简单查询**
- 一问一答的场景
- 不需要上下文的命令
- 独立的功能调用

❌ **不适合场景**
- 需要多轮对话
- 需要上下文理解
- 连续操作流程

---

## 与模式1的对比

| 特性 | 模式1（基础演示） | 模式2（唤醒词循环） |
|------|------------------|-------------------|
| 是否需要唤醒词 | ❌ 不需要 | ✅ 需要 |
| 运行方式 | 单次执行 | 循环执行 |
| 交互次数 | 1次 | 无限次（直到说退出） |
| 程序结束 | 识别完自动结束 | 需要说"退出"或Ctrl+C |
| 适用场景 | 快速测试 | 实际使用 |

---

## 常见问题

### Q1: 如何退出程序？
**A:** 有两种方式：
1. 唤醒后说"退出"或"再见"
2. 按 `Ctrl+C` 强制退出

### Q2: 如果识别失败会怎样？
**A:** 
- 显示"⚠️ 未识别到命令，请重新唤醒"
- 自动进入休眠状态
- 回到等待唤醒状态

### Q3: 可以连续说多个命令吗？
**A:** 
- 不可以，每次只识别一次
- 需要每次都说唤醒词
- 这是设计的核心特性

### Q4: 如何改为持续监听模式？
**A:** 
- 修改代码，注释掉 `assistant.is_awake = False`
- 或者使用 `continuous_listen()` 方法
- 或者参考之前的持续监听实现

### Q5: 唤醒词可以修改吗？
**A:** 
可以！修改代码中的：
```python
assistant = VoiceAssistant(wake_word="小助手", ...)
```
改为：
```python
assistant = VoiceAssistant(wake_word="你好", ...)
# 或其他任何词
```

---

## 总结

### ✅ 完成的修改

1. 将演示模式2改为**唤醒词循环模式**
2. 每次唤醒后**只识别一次**命令
3. 识别后**自动休眠**，需要重新唤醒
4. 更新菜单描述为"唤醒词循环"
5. 添加清晰的提示信息

### 🎯 核心特性

- **唤醒词**: "小助手"
- **交互模式**: 一问一答
- **循环运行**: 无限循环直到退出
- **自动休眠**: 每次识别后自动休眠
- **翻译支持**: 可选启用在线翻译

### 💡 使用建议

- 适合间歇性使用场景
- 符合主流语音助手习惯
- 隐私保护更好
- 资源消耗更低

---

**修改日期**: 2025-10-19  
**版本**: 5.0  
**状态**: ✅ 已完成
